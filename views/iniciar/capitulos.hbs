<!-- Modal -->
<link rel="stylesheet" href="/css/admin.css">
<audio id="audio_pregunta" preload="auto">
  <source id="mp3_src" src="" />
</audio>


<div class="modal fade" id="respuesta" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">

          <img src="" id="img-resultado" width="200" height="200"/>

      </div>


      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Aceptar</button>
      </div>
    </div>

  </div>
</div>



<!-- Modal -->
<div class="modal fade" id="pregunta" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title" id="pregunta-capitulo"></h4>
      </div>
      <div class="modal-body">

        <div>
          <label><div class="jumbotron bg-info w-150 p-3">
              <div class="radio">
          <input type="radio" name="opcion" value="1" id="capitulo-opcion1">
          <img src="" id="capitulo-opcion1-img" width="50" height="50"/>
        </div></div></label>

        <label><div class="jumbotron bg-info w-75 p-3">
              <div class="radio">
          <input type="radio" name="opcion" value="2" id="capitulo-opcion2">
          <img src="" id="capitulo-opcion2-img" width="50" height="50"/>
        </div></div></label>

        <label><div class="jumbotron bg-info w-75 p-3">
              <div class="radio">
          <input type="radio" name="opcion" value="3" id="capitulo-opcion3">
          <img src="" id="capitulo-opcion3-img" width="50" height="50"/>
        </div></div></label>

        <label><div class="jumbotron bg-info w-75 p-3">
              <div class="radio">
          <input type="radio" name="opcion" value="4" id="capitulo-opcion4">
          <img src="" id="capitulo-opcion4-img" width="50" height="50"/>
        </div></div></label>
        </div>


      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default btn-success" data-dismiss="modal" id="verificarRespuesta">Verificar</button>
      </div>
    </div>

  </div>
</div>


<div class="row justify-content-between bg-light modal-body" id="menu">

     <div><a href="../"> <img src="../../images/Logo.png" width="250px"></a></div>

    <div class=" text-right rem">
        <a href="../iniciar" class="btn btn-success"><span class="fa fa-arrow-left" style="font-size: 36px"></span></a>
       <a href="/" id="salir" class="btn btn-danger"><span class="fa fa-sign-out" style="font-size: 36px"></span></a>
    </div>

    <div class="text-center rem">
        <h1 class="title">Cap√≠tulos</h1>
    </div>
</div>
<!-- inicio div capitulos -->
<div class=" panel panel-footer">
  <div class="panel-heading">
    <img src="{{excursion.portada}}" class="img-circle float-right" width="50" height="50">
    <h2 class="panel-title text-center">{{excursion.titulo}}</h2>
    <p class="text-center">
      {{excursion.descripcion}}
    </p>
  </div>
  <div class="panel-footer text-center">
    <iframe width="560" height="315" src="https://www.youtube.com/embed/{{capitulos.0.youtube_url}}" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen id="video"></iframe>
  </div>

  <div class="panel-footer text-center">
    {{#each capitulos}}
      <div class="ver_cap" onclick="cargarVideo({{id}})">
        <img src="{{portada}}" alt="" class="img-responsive">
        <div class="hidden">{{titulo}}</div>
      </div>
    {{/each}}
  </div>
 <br><br>
  <div class="panel-footer text-center">
    <a href="#" id="verpregunta" class="btn btn-info btn-lg fa fa-music"></a>
  </div>
</div>

<script>
  function limpiarRadioInput() {
    $("#capitulo-opcion1").attr('checked', true)
    $("#capitulo-opcion2").attr('checked', true)
    $("#capitulo-opcion3").attr('checked', true)
    $("#capitulo-opcion4").attr('checked', true)
    $("#capitulo-opcion1").attr('checked', false)
    $("#capitulo-opcion2").attr('checked', false)
    $("#capitulo-opcion3").attr('checked', false)
    $("#capitulo-opcion4").attr('checked', false)
  }

  var x;
  var url = window.location.origin;
  var id = localStorage.getItem('id_nino');
  localStorage.setItem('id_capitulo', {{capitulos.0.id}});
  $("#verificarRespuesta").on('click', function(e) {
    e.preventDefault();
    console.log($("input:checked").val())
    let opcion = $("input:checked").val();
    if (opcion != undefined) {
      if(parseInt(opcion) == parseInt(localStorage.getItem("respuesta"))){

        //alert("Respuesta correcta");
        $("#mp3_src").attr("src", "/audios/acierto.mp3");
        var audio = $("#audio_pregunta")[0];
        audio.load();
        audio.play();
        limpiarRadioInput();
      }else {
        let respuesta = parseInt(localStorage.getItem("respuesta")); //leer la respuesta del localStorage
        let img_repuesta = "";
        if(respuesta ==1) {
          //Si es la 1era opcion cargo la imagen del elemento #capitulo-opcion1-img con: $("#capitulo-opcion1-img")
          img_repuesta = $("#capitulo-opcion1-img").attr("src")
          //alert("Respuesta incorrecta. La respuesta era: ")
        }
        if(respuesta ==2) {
          img_repuesta = $("#capitulo-opcion2-img").attr("src")
          //alert("Respuesta incorrecta. La respuesta era: ")
        }
        if(respuesta ==3) {
          img_repuesta = $("#capitulo-opcion3-img").attr("src")
          //alert("Respuesta incorrecta. La respuesta era: ")
        }
        if(respuesta ==4) {
          img_repuesta = $("#capitulo-opcion4-img").attr("src")
          //alert("Respuesta incorrecta. La respuesta era: ")
        }
        $("#respuesta").modal('show');
        $("#img-resultado").attr("src", img_repuesta);
        $("#mp3_src").attr("src", "/audios/incorrecto.mp3");
        var audio = $("#audio_pregunta")[0];
        audio.load();
        audio.play();
        limpiarRadioInput();
        //console.log(img_repuesta);

      }
    }else{
      alert("No haz seleccionado una opcion")
    }
    limpiarRadioInput();
    console.log(opcion)
  })

  $("#verpregunta").on('click', function(e){
    e.preventDefault();
    let id_capitulo = localStorage.getItem('id_capitulo');
    //Consultar la pregunta del capitulo
    $.getJSON( url+"/preguntas/consultar/"+id_capitulo, function( data ) {

      let pregunta = data[0];
      $("#pregunta-capitulo").text(""+pregunta.pregunta);
      $("#capitulo-opcion1-img").attr("src", pregunta.pregunta_1_img);
      $("#capitulo-opcion2-img").attr("src", pregunta.pregunta_2_img);
      $("#capitulo-opcion3-img").attr("src", pregunta.pregunta_3_img);
      $("#capitulo-opcion4-img").attr("src", pregunta.pregunta_4_img);
      localStorage.setItem("respuesta", pregunta.respuesta)

      $("#mp3_src").attr("src", pregunta.pregunta_audio);
      var audio = $("#audio_pregunta")[0];
      audio.load();
      audio.play();
      $('#pregunta').modal('show');
      console.log(data)
    });

  });
  $.getJSON( url+"/usuarios/"+id+"/puntos", function( data ) {
    console.log("-->"+data)
  });
  function guardarIDCapitulo(id) {
    localStorage.setItem('id_capitulo', id)
  }
  function cargarVideo(id){

    //http://localhost:3000/capitulos/1/ver
    console.log(id)
    let xhr = new XMLHttpRequest();
    xhr.open('GET', url+"/capitulos/"+id+"/ver", true);
    xhr.send();
    xhr.onreadystatechange = function(e) {
      if (xhr.readyState == 4 && xhr.status == 200) {
          var response = JSON.parse(xhr.responseText);
          console.log(response)
          guardarIDCapitulo(response.id);
          $("#video").attr("src", "https://www.youtube.com/embed/"+response.youtube_url)
      }
    };
  }
</script>
